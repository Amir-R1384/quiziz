<body class="bg-primary h-screen flex items-center justify-center p-12">
    <form class="bg-light p-5 w-1/3 h-full rounded-2xl form-shadow flex flex-col justify-between items-center">
        <h1 class="font-bold text-2xl clr-primary">Change password</h1>
        <div class="flex flex-col justify-around w-full gap-y-10 h-1/2">
            <div>
                <div id="messageDiv" class="info text-center text-gray-700 font-medium">Enter your new password to change your old one.</div>
            </div>
            <div>
                <input class="w-full border-b-2 border-primary focus:border-gray-900 focus:outline-none focus:bg-gray-100 focus:duration-200 transition  pb-1 my-1 rounded-t-md text-lg px-2" type="password" name="password" id="passwordInp" placeholder="Enter a password">
                <div class="error-div text-red-500" data-for="password"></div>
            </div>
            
        </div>
        
        <button id="submitBtn" class="button button-secondary w-full hover:opacity-95 transition-all">Change password</button>
    </form>
    <script src="/scripts/auth.js"></script>
    <script >
        const submitBtn = document.getElementById('submitBtn')

        submitBtn.addEventListener('click', async e => {
            e.preventDefault()
            document.querySelectorAll('.error-div').forEach(el => el.innerText = '')

            const password = document.getElementById('passwordInp').value
            const email = location.pathname.slice(location.pathname.lastIndexOf('/') + 1) // It's the email which the user registered with

            const res = await fetch('/changePassword', {
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            })

            if (res.ok) {

                const messageDiv = document.getElementById('messageDiv')

                messageDiv.classList.add('success')
                messageDiv.innerHTML = `Your password has been successfuly updated.<br/><br/><a href="/" style="text-decoration: underline;">Go home<a>` 

            } else {
                const err = await res.json()

                if (err.inputs) {
                    for (let name in err.inputs) {
                        const value = err.inputs[name]
                        const errorField = document.querySelector(`.error-div[data-for=${name}]`)
                        errorField.innerText = value
                    }
                    return 
                }

                displayErrorPage(res.status)
            }
        })
        
    </script>
</body>