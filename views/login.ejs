<body class="bg-primary h-screen flex items-center justify-center">
    <form class="bg-light p-5 w-1/3 h-5/6 rounded-2xl form-shadow flex flex-col justify-between items-center">
        <h1 class="font-bold text-2xl clr-primary">Login</h1>
        <div class="flex flex-col justify-around w-full gap-y-10 h-1/2">
            <div>
                <label for="email" class="clr-secondary">Email</label>
                <input class="w-full border-b-2 border-primary focus:border-gray-900 focus:outline-none focus:bg-gray-100 focus:duration-200 transition pb-1 my-1 rounded-t-md text-lg px-2" type="email" name="email" id="email" placeholder="Enter your Email">
                <div class="error-div text-red-500" data-for="email"></div>
            </div>
            <div>
                <label for="password" class="clr-secondary">Password</label>
                <input class="w-full border-b-2 border-primary focus:border-gray-900 focus:outline-none focus:bg-gray-100 focus:duration-200 transition  pb-1 my-1 rounded-t-md text-lg px-2" type="password" name="password" id="password" placeholder="Enter you password">
                <div class="error-div text-red-500" data-for="password"></div>
            </div>
        </div>
        <button id="submitBtn" class="button button-secondary w-full hover:opacity-95 transition-all">Login</button>
    </form>
    <script src="scripts/auth.js"></script>
    <script defer>

        const inputsOrder = ["email", "password"]
        const submitBtn = document.getElementById("submitBtn")
        const form = document.querySelector("form")

        // For going to the next input with the keyboard
        makeTransitionBetweenInputs(inputsOrder)

        // Form submit
        form.addEventListener("keydown", e => {
            if (e.keyCode == 13) e.preventDefault()
        })
        
        submitBtn.addEventListener("click", async e => {
            e.preventDefault()

            // Reseting the error divs and the inputs
            document.querySelectorAll(".error-div").forEach(div => div.textContent = "")
            document.querySelectorAll("input").forEach(div => div.classList.remove("input-error"))

            const { email, password } = form

            try {
                const res = await fetch("/login", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email.value,
                        password: password.value
                    }) 
                })
                
                if (!res.ok) {
                    const { errors } = await res.json()
                    if (!errors) return console.error(res.statusText)
                    
                    for (let errorType in errors) {
                        const input = document.querySelector(`input[id=${errorType}]`)
                        const errorDiv = document.querySelector(`.error-div[data-for=${errorType}]`)
                        errorDiv.textContent = errors[errorType]
                        input.classList.add("input-error")
                    }
                } else {
                    const { route } = await res.json()
                    try {
                        location.assign(route)
                    }
                    catch(err) {
                        console.error(err)
                        location.assign("/")
                    }
                }
            }
            catch(err) {
                console.error(err)
            }
        })
    </script>
</body>