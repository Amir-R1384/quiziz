<body class="bg-primary h-screen flex items-center justify-center p-12">
    <form class="bg-light p-5 w-1/3 h-full rounded-2xl form-shadow flex flex-col justify-between items-center">
        <h1 class="font-bold text-2xl clr-primary">Password reset</h1>
        <div class="flex flex-col justify-around w-full gap-y-10 h-1/2">
            <div>
                <div id="messageDiv" class="info text-center text-gray-700 font-medium">Please enter
                    the email address which you registered with and we'll send you an email to
                    change your password.</div>
            </div>
            <div>
                <input class="w-full border-b-2 border-primary focus:border-gray-900 focus:outline-none focus:bg-gray-100 focus:duration-200 transition  pb-1 my-1 rounded-t-md text-lg px-2" type="email" name="email" id="emailInp" placeholder="Enter an email">
                <div class="error-div text-red-500" data-for="email"></div>
            </div>

        </div>

        <button id="submitBtn" class="button button-secondary w-full hover:opacity-95 transition-all">Request password
            reset</button>
    </form>
    <script src="/scripts/auth.js"></script>
    <script>
        const submitBtn = document.getElementById('submitBtn')

        submitBtn.addEventListener('click', async e => {
            e.preventDefault()
            document.querySelectorAll('.error-div').forEach(el => el.innerText = '')

            const email = document.getElementById('emailInp').value

            const res = await fetch('/forgotPassword', {
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email })
            })

            if (res.ok) {

                const messageDiv = document.getElementById('messageDiv')

                messageDiv.classList.add('success')
                messageDiv.innerHTML = `An email has been sent to <code>${email}</code>. Follow the instrcutions to change your password.`

            } else {
                const err = await res.json()

                if (err.inputs) {
                    for (let name in err.inputs) {
                        const value = err.inputs[name]
                        const errorField = document.querySelector(`.error-div[data-for=${name}]`)
                        errorField.innerText = value
                    }
                    return
                }

                displayErrorPage(res.status)
            }
        })

    </script>
</body>
